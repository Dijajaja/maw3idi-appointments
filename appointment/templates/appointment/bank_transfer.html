{% extends BASE_TEMPLATE|default:"base_templates/black_dashboard_base.html" %}
{% load i18n %}
{% load static %}

{% block navbar_title %}{% trans "Virement bancaire" %}{% endblock %}

{% block customCSS %}
<link rel="stylesheet" type="text/css" href="{% static 'css/appt-common.css' %}"/>
<style>
    body, html {
        overflow-x: hidden !important;
    }
    
    .payment-container {
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
    }
    
    .payment-card {
        background: linear-gradient(135deg, rgba(10, 10, 25, 0.95), rgba(15, 15, 35, 0.9)) !important;
        border-radius: 25px !important;
        padding: 40px !important;
        border: 3px solid rgba(160, 70, 255, 0.4) !important;
        backdrop-filter: blur(20px) saturate(180%) !important;
        -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
        box-shadow: 
            0 8px 32px rgba(0, 0, 0, 0.3),
            0 0 30px rgba(160, 70, 255, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
        color: rgba(255, 255, 255, 0.9) !important;
    }
    
    .payment-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .payment-header h2 {
        color: rgba(255, 255, 255, 0.95);
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 10px;
    }
    
    .payment-summary {
        background: rgba(20, 20, 40, 0.6);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        border: 1px solid rgba(160, 70, 255, 0.2);
        text-align: center;
    }
    
    .payment-amount {
        font-size: 2rem;
        font-weight: 600;
        color: rgba(160, 70, 255, 1);
        margin-bottom: 10px;
    }
    
    .payment-service {
        color: rgba(255, 255, 255, 0.8);
        font-size: 1.1rem;
    }
    
    .bank-accounts {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .bank-account-card {
        background: rgba(20, 20, 40, 0.6);
        border-radius: 15px;
        padding: 25px;
        border: 2px solid rgba(160, 70, 255, 0.3);
        transition: all 0.3s ease;
    }
    
    .bank-account-card:hover {
        border-color: rgba(160, 70, 255, 0.8);
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(160, 70, 255, 0.3);
    }
    
    .bank-name {
        font-size: 1.3rem;
        font-weight: 600;
        color: rgba(160, 70, 255, 1);
        margin-bottom: 20px;
        text-align: center;
    }
    
    .bank-info {
        margin-bottom: 15px;
    }
    
    .bank-info-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
        margin-bottom: 5px;
    }
    
    .bank-info-value {
        color: rgba(255, 255, 255, 0.95);
        font-size: 1.1rem;
        font-weight: 500;
        word-break: break-all;
        background: rgba(10, 10, 25, 0.6);
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid rgba(160, 70, 255, 0.2);
    }
    
    .copy-btn {
        background: rgba(160, 70, 255, 0.2);
        border: 1px solid rgba(160, 70, 255, 0.4);
        color: rgba(160, 70, 255, 1);
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.85rem;
        margin-left: 8px;
        transition: all 0.3s ease;
    }
    
    .copy-btn:hover {
        background: rgba(160, 70, 255, 0.3);
        border-color: rgba(160, 70, 255, 0.6);
    }
    
    .instructions {
        background: rgba(20, 20, 40, 0.6);
        border-radius: 15px;
        padding: 25px;
        margin-top: 30px;
        border: 1px solid rgba(160, 70, 255, 0.2);
    }
    
    .instructions h3 {
        color: rgba(255, 255, 255, 0.95);
        font-size: 1.3rem;
        margin-bottom: 15px;
    }
    
    .instructions ol {
        padding-left: 20px;
        color: rgba(255, 255, 255, 0.8);
    }
    
    .instructions li {
        margin-bottom: 10px;
        line-height: 1.6;
    }
    
    .reference-code {
        background: rgba(160, 70, 255, 0.1);
        border: 2px solid rgba(160, 70, 255, 0.4);
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        margin-top: 20px;
    }
    
    .reference-code-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
        margin-bottom: 8px;
    }
    
    .reference-code-value {
        color: rgba(255, 255, 255, 0.95);
        font-size: 1.5rem;
        font-weight: 600;
        font-family: monospace;
        letter-spacing: 2px;
    }
</style>
{% endblock %}

{% block body %}
<div class="payment-container">
    <div class="payment-card">
        <div class="payment-header">
            <h2>{% trans "Virement bancaire" %}</h2>
        </div>
        
        <div class="payment-summary">
            <div class="payment-amount">{{ amount }}{{ currency|default:" MRU" }}</div>
            <div class="payment-service">{{ service_name }}</div>
        </div>
        
        <div class="reference-code">
            <div class="reference-code-label">{% trans "Code de référence" %}</div>
            <div class="reference-code-value" id="reference-code">{{ id_request }}</div>
            <button type="button" class="copy-btn" onclick="copyReferenceCode()">
                <i class="fas fa-copy"></i> {% trans "Copier" %}
            </button>
        </div>
        
        <div class="bank-accounts">
            {% for bank_key, bank_info in bank_accounts.items %}
            {% if bank_info.account_number %}
            <div class="bank-account-card">
                <div class="bank-name">
                    <i class="fas fa-university"></i> {{ bank_info.name }}
                </div>
                
                {% if bank_info.account_number %}
                <div class="bank-info">
                    <div class="bank-info-label">{% trans "Numéro de compte" %}</div>
                    <div class="bank-info-value" id="account-{{ bank_key }}">
                        {{ bank_info.account_number }}
                        <button type="button" class="copy-btn" onclick="copyToClipboard('account-{{ bank_key }}')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                {% endif %}
                
                {% if bank_info.iban %}
                <div class="bank-info">
                    <div class="bank-info-label">{% trans "IBAN" %}</div>
                    <div class="bank-info-value" id="iban-{{ bank_key }}">
                        {{ bank_info.iban }}
                        <button type="button" class="copy-btn" onclick="copyToClipboard('iban-{{ bank_key }}')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                {% endif %}
                
                {% if bank_info.swift %}
                <div class="bank-info">
                    <div class="bank-info-label">{% trans "SWIFT/BIC" %}</div>
                    <div class="bank-info-value" id="swift-{{ bank_key }}">
                        {{ bank_info.swift }}
                        <button type="button" class="copy-btn" onclick="copyToClipboard('swift-{{ bank_key }}')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}
            {% endfor %}
        </div>
        
        <div class="instructions">
            <h3>{% trans "Instructions pour le virement" %}</h3>
            <ol>
                <li>{% trans "Effectuez un virement bancaire vers l'un des comptes ci-dessus." %}</li>
                <li>{% trans "Utilisez le code de référence comme motif du virement." %}</li>
                <li>{% trans "Envoyez-nous une copie du reçu de virement par email ou via votre espace client." %}</li>
                <li>{% trans "Une fois le virement confirmé, votre rendez-vous sera automatiquement validé." %}</li>
            </ol>
            <p style="margin-top: 15px; color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                <i class="fas fa-info-circle"></i> 
                {% trans "Note: Le traitement du virement peut prendre 1 à 3 jours ouvrables." %}
            </p>
        </div>
    </div>
</div>

<script>
    function copyToClipboard(elementId) {
        const element = document.getElementById(elementId);
        const text = element.textContent.replace(/[\s\S]*?Copier/, '').trim();
        
        // Créer un élément temporaire pour copier le texte
        const tempInput = document.createElement('input');
        tempInput.value = text;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        
        // Afficher un message de confirmation
        const btn = element.querySelector('.copy-btn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> {% trans "Copié!" %}';
        btn.style.background = 'rgba(76, 175, 80, 0.3)';
        btn.style.borderColor = 'rgba(76, 175, 80, 0.6)';
        btn.style.color = '#4CAF50';
        
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = '';
            btn.style.borderColor = '';
            btn.style.color = '';
        }, 2000);
    }
    
    function copyReferenceCode() {
        const code = document.getElementById('reference-code').textContent.trim();
        const tempInput = document.createElement('input');
        tempInput.value = code;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        
        const btn = event.target;
        btn.innerHTML = '<i class="fas fa-check"></i> {% trans "Copié!" %}';
        setTimeout(() => {
            btn.innerHTML = '<i class="fas fa-copy"></i> {% trans "Copier" %}';
        }, 2000);
    }
</script>
{% endblock %}

